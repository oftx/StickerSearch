# ä¸­æ–‡è¯­ä¹‰å›¾ç‰‡æœç´¢

è¿™æ˜¯ä¸€ä¸ªåŸºäº [Chinese-CLIP](https://github.com/OFA-Sys/Chinese-CLIP) æ¨¡å‹çš„æœ¬åœ°å›¾ç‰‡è¯­ä¹‰æœç´¢å¼•æ“ï¼Œå¯¹äºæœç´¢è¡¨æƒ…åŒ…å°¤å…¶å¥½ç”¨ã€‚å®ƒå…è®¸ä½ ä½¿ç”¨è‡ªç„¶çš„ä¸­æ–‡æè¿°æ¥æŸ¥æ‰¾ä½ ç”µè„‘ä¸Šçš„è§†è§‰ç´ æï¼Œå¹¶æä¾›äº†ä¸€ä¸ªç®€å•æ˜“ç”¨çš„Webç•Œé¢è¿›è¡Œäº¤äº’ã€‚

![screenshot](assets/screenshot.jpg)


## ğŸŒŸ ä¸»è¦åŠŸèƒ½

*   **ä¸­æ–‡è¯­ä¹‰æœç´¢**: ä½¿ç”¨å¼ºå¤§çš„AIæ¨¡å‹ï¼Œå¯é€šè¿‡è‡ªç„¶è¯­è¨€æè¿°æ¥æŸ¥æ‰¾å›¾ç‰‡ã€‚
*   **Webç”¨æˆ·ç•Œé¢**: æä¾›ä¸€ä¸ªåŸºäºFlaskçš„ç›´è§‚ç½‘é¡µï¼Œç”¨äºæœç´¢ã€é¢„è§ˆå’Œç®¡ç†å›¾ç‰‡ã€‚
*   **é«˜æ€§èƒ½ç´¢å¼•**:
    *   é¦–æ¬¡ä¸ºä½ çš„å›¾ç‰‡åº“åˆ›å»ºç‰¹å¾ç´¢å¼•ï¼Œå®ç°å¿«é€Ÿæœç´¢ã€‚
    *   æ”¯æŒå¢é‡æ›´æ–°ï¼Œä»…å¤„ç†æ–°å¢æˆ–ä¿®æ”¹è¿‡çš„æ–‡ä»¶ã€‚
*   **æ ¼å¼è½¬æ¢ä¸å¤åˆ¶**:
    *   å†…ç½®é«˜è´¨é‡çš„ `webm` åˆ° `gif` çš„è½¬æ¢åŠŸèƒ½ã€‚
    *   æ”¯æŒä¸€é”®å°†æ–‡ä»¶ï¼ˆæˆ–å…¶è½¬æ¢åçš„æ ¼å¼ï¼‰å¤åˆ¶åˆ°ç³»ç»Ÿå‰ªè´´æ¿ï¼Œæ–¹ä¾¿åœ¨å¾®ä¿¡ã€QQç­‰åº”ç”¨ä¸­ä½¿ç”¨ã€‚
*   **è·¨å¹³å°éƒ¨ç½²**: æä¾›äº†åœ¨ Windows å’Œ macOS ä¸Šçš„è¯¦ç»†éƒ¨ç½²æŒ‡å—ã€‚


## ğŸš€ éƒ¨ç½²æŒ‡å—

> æ­¤éƒ¨åˆ†ç”± AI ç¼–å†™ï¼Œä¾›å‚è€ƒ (oã‚œâ–½ã‚œ)oâ˜†  

åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹åŸºæœ¬è¦æ±‚ï¼š

*   Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
*   Git å‘½ä»¤è¡Œå·¥å…·
*   è‡³å°‘ 8GB å†…å­˜

---

### **é€šç”¨é¢„å¤‡æ­¥éª¤ï¼šå®‰è£… FFmpeg**

æœ¬é¡¹ç›®ä½¿ç”¨ FFmpeg è¿›è¡Œè§†é¢‘/GIFæ–‡ä»¶çš„å¤„ç†å’Œæ ¼å¼è½¬æ¢ï¼Œè¿™æ˜¯ä¸€ä¸ª**å¿…é¡»**çš„å¤–éƒ¨ä¾èµ–ã€‚

#### **macOS ç”¨æˆ· (æ¨èä½¿ç”¨ Homebrew)**

æ‰“å¼€â€œç»ˆç«¯â€ (Terminal) åº”ç”¨ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
brew install ffmpeg
```

Homebrew ä¼šè‡ªåŠ¨å¤„ç†å®‰è£…å’Œè·¯å¾„é…ç½®ï¼Œå®‰è£…å®Œæˆåå³å¯ä½¿ç”¨ã€‚

#### **Windows ç”¨æˆ·**

**æ–¹æ³•ä¸€ï¼šä½¿ç”¨ Winget åŒ…ç®¡ç†å™¨ (æ¨è)**

æ‰“å¼€â€œå‘½ä»¤æç¤ºç¬¦â€ (cmd) æˆ– â€œPowerShellâ€ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
winget install "FFmpeg Team.FFmpeg"
```

Winget ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£… FFmpegï¼Œå¹¶é€šå¸¸ä¼šå°†å…¶æ·»åŠ åˆ°ç³»ç»Ÿè·¯å¾„ä¸­ã€‚

**æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…**

1.  è®¿é—® [FFmpeg å®˜æ–¹ä¸‹è½½é¡µé¢](https://ffmpeg.org/download.html)ã€‚
2.  åœ¨ Windows å›¾æ ‡ä¸‹ï¼Œç‚¹å‡»æ¨èçš„ `gyan.dev` æˆ– `BtbN` é“¾æ¥ã€‚
3.  ä¸‹è½½ä¸€ä¸ª `release-full.7z` ç‰ˆæœ¬çš„å‹ç¼©åŒ…ã€‚
4.  è§£å‹åˆ°ä¸€ä¸ªä½ å–œæ¬¢çš„ä½ç½®ï¼Œä¾‹å¦‚ `D:\ffmpeg`ã€‚
5.  **å°† FFmpeg æ·»åŠ åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ `Path` ä¸­**ï¼š
    *   åœ¨Windowsæœç´¢æ æœç´¢ â€œç¼–è¾‘ç³»ç»Ÿç¯å¢ƒå˜é‡â€ å¹¶æ‰“å¼€å®ƒã€‚
    *   åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼Œç‚¹å‡» â€œç¯å¢ƒå˜é‡...â€ æŒ‰é’®ã€‚
    *   åœ¨ â€œç³»ç»Ÿå˜é‡â€ åŒºåŸŸæ‰¾åˆ°åä¸º `Path` çš„å˜é‡ï¼Œé€‰ä¸­å®ƒï¼Œç„¶åç‚¹å‡» â€œç¼–è¾‘...â€ã€‚
    *   ç‚¹å‡» â€œæ–°å»ºâ€ï¼Œç„¶åè¾“å…¥ä½ åˆšåˆšè§£å‹çš„ FFmpeg æ–‡ä»¶å¤¹ä¸­çš„ `bin` ç›®å½•çš„å®Œæ•´è·¯å¾„ï¼Œä¾‹å¦‚ï¼š`D:\ffmpeg\bin`ã€‚
    *   ä¸€è·¯ç‚¹å‡»â€œç¡®å®šâ€ä¿å­˜æ‰€æœ‰è®¾ç½®ã€‚

**éªŒè¯å®‰è£…**ï¼š
æ— è®ºä½¿ç”¨å“ªç§æ–¹æ³•ï¼Œæ–°å¼€ä¸€ä¸ªç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦çª—å£ï¼Œè¾“å…¥ `ffmpeg -version`ã€‚å¦‚æœèƒ½çœ‹åˆ°ç‰ˆæœ¬ä¿¡æ¯è¾“å‡ºï¼Œè¯´æ˜ FFmpeg å·²æˆåŠŸå®‰è£…å¹¶é…ç½®ã€‚

---

### **é¡¹ç›®éƒ¨ç½²æ­¥éª¤**

#### **1. å…‹éš†é¡¹ç›®ä»“åº“**

æ‰“å¼€ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ï¼Œè¿›å…¥ä½ æƒ³è¦å­˜æ”¾é¡¹ç›®çš„ç›®å½•ï¼Œç„¶åè¿è¡Œï¼š

```bash
git clone https://github.com/oftx/StickerSearch.git
cd StickerSearch
```

#### **2. åˆ›å»ºå¹¶æ¿€æ´»Pythonè™šæ‹Ÿç¯å¢ƒ (æ¨è)**

ä¸ºä¿è¯é¡¹ç›®ä¾èµ–éš”ç¦»ï¼Œå¼ºçƒˆå»ºè®®ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒã€‚

##### **ğŸ’» macOS ç”¨æˆ· (å°¤å…¶ Apple Silicon M ç³»åˆ—èŠ¯ç‰‡)**

å¯¹äº M ç³»åˆ—èŠ¯ç‰‡çš„ Macï¼Œä½¿ç”¨ `conda` æ¥ç®¡ç†ç¯å¢ƒå¯ä»¥æ›´å¥½åœ°å¤„ç†å¤æ‚çš„ç§‘å­¦è®¡ç®—åŒ…ï¼ˆå¦‚ PyTorchï¼‰ï¼Œå……åˆ†åˆ©ç”¨ Metal (MPS) è¿›è¡ŒåŠ é€Ÿã€‚

1.  **å®‰è£… Conda**: å¦‚æœä½ å°šæœªå®‰è£…ï¼Œè¯·ä» [Minicondaå®˜ç½‘](https://docs.conda.io/en/latest/miniconda.html) ä¸‹è½½å¹¶å®‰è£…é€‚ç”¨äº macOS çš„ç‰ˆæœ¬ã€‚

2.  **åˆ›å»ºå¹¶æ¿€æ´» Conda ç¯å¢ƒ**:
    ```bash
    # åˆ›å»ºä¸€ä¸ªåä¸º stickersearch çš„æ–°ç¯å¢ƒï¼Œå¹¶æŒ‡å®š Python ç‰ˆæœ¬
    conda create -n stickersearch python=3.9 -y

    # æ¿€æ´»ç¯å¢ƒ
    conda activate stickersearch
    ```
    æ¿€æ´»æˆåŠŸåï¼Œä½ çš„å‘½ä»¤è¡Œæç¤ºç¬¦å‰ä¼šæœ‰ä¸€ä¸ª `(stickersearch)` æ ‡è®°ã€‚

##### **ğŸªŸ Windows å’Œ Intel Mac ç”¨æˆ·**

ä½¿ç”¨ Python å†…ç½®çš„ `venv` å³å¯ã€‚

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# åœ¨ Windows ä¸Š:
venv\Scripts\activate

# åœ¨ macOS (Intel) ä¸Š:
source venv/bin/activate
```
æ¿€æ´»æˆåŠŸåï¼Œä½ çš„å‘½ä»¤è¡Œæç¤ºç¬¦å‰ä¼šæœ‰ä¸€ä¸ª `(venv)` æ ‡è®°ã€‚

#### **3. å®‰è£…Pythonä¾èµ–**

è¯·ç¡®ä¿ä½ å·²ç»æ¿€æ´»äº†è™šæ‹Ÿç¯å¢ƒï¼Œç„¶åæ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿå®‰è£…ä¾èµ–ã€‚

> ä¸­å›½å¤§é™†ä¾èµ–ä¸‹è½½è¾ƒæ…¢å¯ä»¥åœ¨å‘½ä»¤æœ«å°¾æ·»åŠ é•œåƒå‚æ•° `-i https://pypi.tuna.tsinghua.edu.cn/simple`

##### **ğŸ’» macOS ç”¨æˆ·**
```bash
pip install -r requirements.txt
```

##### **ğŸªŸ Windows ç”¨æˆ·**

Windows éœ€è¦ä¸€äº›é¢å¤–çš„åº“ä»¥å®ç°å¤åˆ¶å›¾åƒçš„åŠŸèƒ½ï¼š
```bash
pip install pywin32
```

éƒ¨ç½²å®Œæˆï¼æ¥ä¸‹æ¥è¯·çœ‹ä½¿ç”¨è¯´æ˜ã€‚

## ğŸ“– ä½¿ç”¨è¯´æ˜

#### **ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡AIæ¨¡å‹**

åœ¨å¼€å§‹ä½¿ç”¨å‰ï¼Œä½ éœ€è¦ä¸‹è½½é¡¹ç›®æ‰€éœ€çš„ä¸­æ–‡CLIPæ¨¡å‹ã€‚æœ‰ä¸‹é¢ä¸¤ç§æ–¹å¼ï¼š

##### æ–¹å¼ä¸€ï¼šä½¿ç”¨äº¤äº’å¼è„šæœ¬ (æ¨è)

é¡¹ç›®æä¾›äº†ä¸€ä¸ªäº¤äº’å¼è„šæœ¬æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè¿è¡Œè„šæœ¬ï¼š
```bash
python prepare_model_script.py
```

è„šæœ¬ä¼šå¼•å¯¼ä½ å®Œæˆä»¥ä¸‹é€‰æ‹©ï¼š
1.  **é€‰æ‹©æ¨¡å‹**: å¯¹äºå¤§å¤šæ•°ç”¨æˆ·ï¼Œç›´æ¥æŒ‰å›è½¦é€‰æ‹©**é»˜è®¤æ¨¡å‹**å³å¯ã€‚
2.  **é€‰æ‹©ä¸‹è½½ä½ç½®**: æ¨èç›´æ¥æŒ‰å›è½¦ï¼Œå°†æ¨¡å‹ä¸‹è½½åˆ°å½“å‰é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹ã€‚
3.  **é€‰æ‹©é•œåƒç«™ç‚¹**: å¦‚æœä½ è®¿é—®Hugging Faceå®˜ç½‘é€Ÿåº¦æ…¢ï¼Œå¯ä»¥é€‰æ‹©ä¸€ä¸ªé•œåƒç«™ï¼ˆå¦‚ `hf-mirror.com`ï¼‰æ¥åŠ é€Ÿä¸‹è½½ã€‚
4.  **è®¾ç½®ä»£ç†**: å¦‚æœä½ éœ€è¦é€šè¿‡ä»£ç†è®¿é—®ç½‘ç»œï¼Œå¯ä»¥åœ¨æ­¤è¾“å…¥ä½ çš„ä»£ç†åœ°å€ã€‚

è„šæœ¬ä¼šè‡ªåŠ¨ä¸‹è½½æ¨¡å‹ï¼ˆçº¦750MBï¼‰ï¼Œå¹¶åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª `config.json` æ–‡ä»¶æ¥è®°å½•æ¨¡å‹è·¯å¾„ã€‚

##### æ–¹å¼äºŒï¼šæ‰‹åŠ¨ä¸‹è½½ (é€‚ç”¨äºé«˜çº§ç”¨æˆ·æˆ–è„šæœ¬ä¸‹è½½å¤±è´¥æ—¶)

å¦‚æœä½ æ— æ³•ä½¿ç”¨ä¸Šè¿°è„šæœ¬ï¼Œæˆ–è€…æ›´å–œæ¬¢æ‰‹åŠ¨æ§åˆ¶ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1.  **å®‰è£… Git LFS**: æ¨¡å‹æ–‡ä»¶è¾ƒå¤§ï¼Œéœ€è¦ä½¿ç”¨ Git Large File Storage (LFS) æ¥å…‹éš†ã€‚å¦‚æœå°šæœªå®‰è£…ï¼Œè¯·å…ˆå®‰è£…å®ƒã€‚
    *   è®¿é—® [Git LFS å®˜ç½‘](https://git-lfs.com/) å¹¶æ ¹æ®ä½ çš„æ“ä½œç³»ç»Ÿè¿›è¡Œå®‰è£…ã€‚
    *   å®‰è£…å®Œæˆåï¼Œæ‰“å¼€ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ï¼Œè¿è¡Œä¸€æ¬¡æ€§è®¾ç½®å‘½ä»¤ï¼š
        ```bash
        git lfs install
        ```

2.  **å…‹éš†æ¨¡å‹ä»“åº“**: åœ¨æœ¬é¡¹ç›®çš„ **æ ¹ç›®å½•** ä¸‹ï¼Œæ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å…‹éš†é»˜è®¤çš„æ¨¡å‹ï¼š
    ```bash
    git clone https://huggingface.co/OFA-Sys/chinese-clip-vit-base-patch16
    ```
    è¿™ä¸ªå‘½ä»¤ä¼šåœ¨ä½ çš„é¡¹ç›®æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªåä¸º `chinese-clip-vit-base-patch16` çš„å­æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸‹è½½æ‰€æœ‰æ¨¡å‹æ–‡ä»¶ã€‚

3.  **åˆ›å»ºé…ç½®æ–‡ä»¶**: åœ¨é¡¹ç›®çš„ **æ ¹ç›®å½•** ä¸‹ï¼Œæ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªåä¸º `config.json` çš„æ–‡ä»¶ã€‚

4.  **ç¼–è¾‘é…ç½®æ–‡ä»¶**: åœ¨ `config.json` æ–‡ä»¶ä¸­ï¼Œå¡«å…¥ä»¥ä¸‹å†…å®¹ï¼Œä»¥å‘ŠçŸ¥ç¨‹åºæ¨¡å‹çš„å­˜æ”¾ä½ç½®ï¼š
    ```json
    {
        "model_path": "chinese-clip-vit-base-patch16"
    }
    ```
    > **æ³¨æ„**: è¯·ç¡®ä¿ `"model_path"` çš„å€¼ä¸ä½ åˆšåˆšå…‹éš†ä¸‹æ¥çš„æ–‡ä»¶å¤¹åç§°å®Œå…¨ä¸€è‡´ã€‚

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œæ¨¡å‹å°±å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥äº†ã€‚

#### **ç¬¬äºŒæ­¥ï¼šè¿è¡ŒWebåº”ç”¨**

æ¨¡å‹å‡†å¤‡å¥½åï¼Œå¯åŠ¨WebæœåŠ¡å™¨ï¼š
```bash
python app.py
```
å½“ä½ åœ¨ç»ˆç«¯çœ‹åˆ°ç±»ä¼¼ `* Running on http://127.0.0.1:5001` çš„è¾“å‡ºæ—¶ï¼Œè¯´æ˜æœåŠ¡å·²æˆåŠŸå¯åŠ¨ã€‚

#### **ç¬¬ä¸‰æ­¥ï¼šåˆ›å»º/æ›´æ–°ç´¢å¼•**

1.  æ‰“å¼€ä½ çš„æµè§ˆå™¨ï¼Œè®¿é—® **[http://127.0.0.1:5001](http://127.0.0.1:5001)**ã€‚
2.  ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„ **è®¾ç½®å›¾æ ‡ (âš™ï¸)**ã€‚
3.  åœ¨å¼¹å‡ºçš„â€œç´¢å¼•è®¾ç½®â€çª—å£ä¸­ï¼Œè¾“å…¥ä½ çš„å›¾ç‰‡æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„çš†å¯ã€‚ä¾‹å¦‚ï¼Œ`D:\stickers` æˆ– `stickers`ã€‚
> æŠŠè¡¨æƒ…è´´çº¸æ–‡ä»¶å¤¹æ”¾å…¥é¡¹ç›®æ ¹ç›®å½•ä¸‹å¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„
4.  ç‚¹å‡» **â€œå¼€å§‹/æ›´æ–°ç´¢å¼•â€** æŒ‰é’®ã€‚
5.  é¦–æ¬¡å»ºç«‹ç´¢å¼•ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œå› ä¸ºéœ€è¦ä¸ºæ¯å¼ å›¾ç‰‡æå–ç‰¹å¾ã€‚è¯·è€å¿ƒç­‰å¾…ï¼Œç›´åˆ°ä¸‹æ–¹æ˜¾ç¤ºâ€œç´¢å¼•æ›´æ–°æˆåŠŸï¼â€çš„æ‘˜è¦ä¿¡æ¯ã€‚

> ç»è¿‡å®æµ‹ï¼Œç´¢å¼• 10000 å¼ å›¾ç‰‡å¤§çº¦éœ€è¦ 10 åˆ†é’Ÿï¼Œnpz æ–‡ä»¶å¤§å°çº¦ 20 MBã€‚  

ç´¢å¼•å®Œæˆåï¼Œä½ å°±å¯ä»¥åœ¨ä¸»é¡µé¢çš„æœç´¢æ¡†ä¸­è¾“å…¥ä¸­æ–‡æè¿°æ¥å¼€å§‹ä½ çš„è¯­ä¹‰æœç´¢ä¹‹æ—…äº†ï¼


## å…¶ä»–ç›¸å…³é“¾æ¥

- [chn-lee-yumi/MaterialSearch](https://github.com/chn-lee-yumi/MaterialSearch)
- [è‡ªåˆ¶è¡¨æƒ…åŒ…æœç´¢å¼•æ“ æ¼”ç¤º - BD4SUR](https://www.bilibili.com/video/BV1vJ4m1e7MN)
- [MyGOè¡¨æƒ…åŒ…æœå°‹å™¨](https://mygo.miyago9267.com/)
